webpackJsonp([4],{"/WlP":function(e,t){},"5n5g":function(e,t){},FkkJ:function(e,t){},NQpb:function(e,t){},RLHB:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("Xxa5"),i=a.n(r),n=a("exGp"),s=a.n(n),o={name:"DeviceModal",props:{visible:Boolean,addOrEdit:String,deviceInfo:Object},data:function(){return{title:"",typeList:[],form:{name:"",type:"",ip:"",port:502,sort:void 0,status:""},rules:{name:[{required:!0,message:"设备名称不能为空",trigger:"blur"}],type:[{required:!0,message:"设备类型不能为空",trigger:"change"}],ip:[{required:!0,message:"IP地址不能为空",trigger:"blur"}],port:[{required:!0,message:"端口号不能为空",trigger:"blur"}]}}},watch:{addOrEdit:{handler:function(e){this.title="add"==e?"新建设备":"编辑设备"}},visible:{handler:function(e){var t=this;e&&(this.getDeviceTypeAll(),"edit"==this.addOrEdit&&this.$nextTick(function(){t.form.status=t.deviceInfo.enableStatus.value,t.form.name=t.deviceInfo.deviceName,t.form.type=t.deviceInfo.deviceTypeId,t.form.ip=t.deviceInfo.ip,t.form.port=t.deviceInfo.port,t.form.sort=t.deviceInfo.sortNumber}))},immediate:!0}},methods:{updateVisible:function(e){this.$refs.form.resetFields(),this.$emit("update:visible",e)},submitForm:function(){var e=this;this.$refs.form.validate(function(t){if(!t)return console.log("error submit!!"),!1;"add"==e.addOrEdit?e.insertDevice():e.updateDevice()})},getDeviceTypeAll:function(){var e=this;return s()(i.a.mark(function t(){var a;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.$http.get("/deviceType/queryAll");case 3:a=t.sent,e.typeList=a.data.data,t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),console.log(t.t0);case 10:case"end":return t.stop()}},t,e,[[0,7]])}))()},insertDevice:function(){var e=this;return s()(i.a.mark(function t(){var a;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.$http.post("/device/insert",{deviceName:e.form.name,deviceTypeId:e.form.type,ip:e.form.ip,port:e.form.port,sortNumber:e.form.sort});case 3:200==(a=t.sent).data.code?(e.$message.success("添加设备成功"),e.updateVisible(!1),e.$parent.queryByNameOrTypeId()):e.$message.error(a.data.msg),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),console.log(t.t0);case 10:case"end":return t.stop()}},t,e,[[0,7]])}))()},updateDevice:function(){var e=this;return s()(i.a.mark(function t(){var a;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.$http.post("/device/update",{deviceName:e.form.name,deviceTypeId:e.form.type,ip:e.form.ip,port:e.form.port,sortNumber:""==e.form.sort?null:e.form.sort,deviceId:e.deviceInfo.deviceId,enableStatus:e.form.status});case 3:200==(a=t.sent).data.code?(e.$message.success("编辑设备成功"),e.updateVisible(!1),e.$parent.queryByNameOrTypeId()):e.$message.error(a.data.msg),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),console.log(t.t0);case 10:case"end":return t.stop()}},t,e,[[0,7]])}))()}}},l={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{staticClass:"modal",attrs:{title:e.title,visible:e.visible,width:"30%","close-on-click-modal":!1},on:{"update:visible":e.updateVisible}},[a("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-position":"right","label-width":"80px"}},[a("el-form-item",{attrs:{label:"设备类型",prop:"type"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{clearable:"",placeholder:"请选择设备类型",disabled:"edit"==e.addOrEdit},model:{value:e.form.type,callback:function(t){e.$set(e.form,"type",t)},expression:"form.type"}},e._l(e.typeList,function(e,t){return a("el-option",{key:t,attrs:{label:e.deviceTypeName+" ("+e.communicationProtocol.name+")",value:e.deviceTypeId}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"设备名称",prop:"name"}},[a("el-input",{attrs:{clearable:"",placeholder:"请输入设备名称"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"IP地址",prop:"ip"}},[a("el-input",{attrs:{clearable:"",placeholder:"请输入IP地址"},model:{value:e.form.ip,callback:function(t){e.$set(e.form,"ip",t)},expression:"form.ip"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"端口号",prop:"port"}},[a("el-input-number",{staticClass:"input-number",attrs:{"controls-position":"right",min:0,placeholder:"请输入端口号"},model:{value:e.form.port,callback:function(t){e.$set(e.form,"port",t)},expression:"form.port"}})],1),e._v(" "),"edit"==this.addOrEdit?a("el-form-item",{attrs:{label:"设备状态",prop:"status"}},[a("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#ff4949","active-value":1,"inactive-value":0,"active-text":"启用","inactive-text":"禁用"},model:{value:e.form.status,callback:function(t){e.$set(e.form,"status",t)},expression:"form.status"}})],1):e._e(),e._v(" "),a("el-form-item",{attrs:{label:"排序序号",prop:"sort"}},[a("el-input-number",{staticClass:"input-number",attrs:{"controls-position":"right",min:0,placeholder:"请输入排序序号(默认200)"},model:{value:e.form.sort,callback:function(t){e.$set(e.form,"sort",t)},expression:"form.sort"}})],1)],1),e._v(" "),a("span",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){return e.updateVisible(!1)}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.submitForm}},[e._v("确 定")])],1)],1)},staticRenderFns:[]};var c=a("VU/8")(o,l,!1,function(e){a("FkkJ")},"data-v-0b46b87c",null).exports,u={name:"ElementDrag",props:{outerOptions:{type:Object,default:function(){return{background:"rgba(0,0,0,0)"}}},innerOptions:{type:Object,default:function(){return{background:"rgba(0,0,0,0)"}}},scaleZoom:{type:Object,default:function(){return{max:5,min:.2}}}},data:function(){return{isMousedown:!1,isHover:!1,moveStart:{},translate:{x:0,y:0},scale:1,beforeX:null,beforeY:null,afterX:null,afterY:null}},methods:{handleScroll:function(e){if(this.isHover&&this.$refs.dragElement){var t=e.wheelDelta/120;e.wheelDelta>0&&this.scale<this.scaleZoom.max?(this.scale+=.04*t,this.$refs.dragElement.style.transform="scale("+this.scale+") translate("+this.translate.x+"px, "+this.translate.y+"px)"):e.wheelDelta<0&&this.scale>this.scaleZoom.min&&(this.scale+=.04*t,this.$refs.dragElement.style.transform="scale("+this.scale+") translate("+this.translate.x+"px, "+this.translate.y+"px)")}},dragMousedown:function(e){this.moveStart.x=e.clientX,this.moveStart.y=e.clientY,this.isMousedown=!0,this.beforeX=e.clientX,this.beforeY=e.clientX},dragMouseup:function(e){this.isMousedown=!1,this.afterX=e.clientX,this.afterY=e.clientX},dragMousemove:function(){this.isMousedown&&(this.translate.x+=(event.clientX-this.moveStart.x)/this.scale,this.translate.y+=(event.clientY-this.moveStart.y)/this.scale,this.$refs.dragElement.style.transform="scale("+this.scale+") translate("+this.translate.x+"px, "+this.translate.y+"px)",this.moveStart.x=event.clientX,this.moveStart.y=event.clientY)}},mounted:function(){window.addEventListener("mousewheel",this.handleScroll,!1)}},d={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{ref:"dragWrap",staticClass:"drag-outer",style:e.outerOptions,on:{mouseenter:function(t){e.isHover=!0},mouseleave:function(t){e.isHover=e.isMousedown=!1},mousemove:e.dragMousemove}},[a("div",{ref:"dragElement",staticClass:"drag-inner",style:e.innerOptions,on:{mousedown:e.dragMousedown,mouseup:function(t){return t.stopPropagation(),e.dragMouseup.apply(null,arguments)}}},[e._t("default")],2)])},staticRenderFns:[]};var p={name:"ImageModal",components:{ElementDrag:a("VU/8")(u,d,!1,function(e){a("5n5g")},"data-v-e957294e",null).exports},props:{visible:Boolean,deviceInfo:Object,imageUrl:String},data:function(){return{location:null,scale:1}},methods:{updateVisible:function(e){this.$emit("update:visible",e)},submitConfirm:function(){this.updateLocation(),this.updateVisible(!1)},clickImg:function(e){if(this.$refs.drag.beforeX===this.$refs.drag.afterX&&this.$refs.drag.beforeY===this.$refs.drag.afterY){var t=this.$refs.marker;this.location=e.offsetX+","+e.offsetY,t.style.display="inline-block",t.style.fontSize="40px",t.style.color="red",t.style.position="absolute",t.style.top=e.offsetY-[20*(this.scale+.44)-18*(this.scale-.04-1)]+"px",t.style.left=e.offsetX-20+"px"}},openDialog:function(){var e=this.$refs.marker;if(this.deviceInfo.deviceLocation&&""!==this.deviceInfo.deviceLocation&&null!==this.deviceInfo.deviceLocation){var t=this.deviceInfo.deviceLocation.split(",");e.style.display="inline-block",e.style.fontSize="40px",e.style.color="red",e.style.position="absolute",e.style.top=t[1]-[20*(this.scale+.44)-18*(this.scale-.04-1)]+"px",e.style.left=t[0]-20+"px"}},wheelMarker:function(e){var t=this.$refs.marker;if(t){var a=e.wheelDelta/120;this.scale>=.2&&this.scale<=5&&(this.scale+=.04*a,this.scale>5&&(this.scale=5),this.scale<.2&&(this.scale=.2),this.scale=parseFloat(this.scale.toFixed(2)),t.style.transform="scale("+1/this.scale+") translate(0, "+18*(this.scale-.04-1)+"px)")}},updateLocation:function(){var e=this;return s()(i.a.mark(function t(){return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.$http.post("/device/updateLocation",{deviceId:e.deviceInfo.deviceId,deviceLocation:e.location});case 3:e.$message.success("更新设备位置成功"),e.$parent.queryByNameOrTypeId(),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),console.log(t.t0);case 10:case"end":return t.stop()}},t,e,[[0,7]])}))()}}},m={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{staticClass:"modal",attrs:{title:"设备位置",visible:e.visible,fullscreen:"","append-to-body":"","close-on-click-modal":!1},on:{"update:visible":e.updateVisible,opened:e.openDialog}},[a("div",{staticClass:"drag-box",on:{mousewheel:e.wheelMarker}},[a("element-drag",{ref:"drag"},[a("div",{staticClass:"drag-main"},[a("img",{attrs:{src:e.imageUrl,alt:""},on:{click:e.clickImg}}),e._v(" "),a("i",{ref:"marker",staticClass:"el-icon-location",staticStyle:{display:"none"}})])])],1),e._v(" "),a("span",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){return e.updateVisible(!1)}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.submitConfirm}},[e._v("确 定")])],1)])},staticRenderFns:[]};var f={name:"DeviceManage",components:{DeviceModal:c,ImageModal:a("VU/8")(p,m,!1,function(e){a("NQpb")},"data-v-3440b7c1",null).exports},data:function(){return{formInfo:{name:"",type:""},typeList:[],tableData:[],curPage:1,deviceVisible:!1,addOrEdit:"",deviceInfo:{},imageVisible:!1,imageUrl:""}},created:function(){var e=this;return s()(i.a.mark(function t(){return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.getDeviceTypeAll();case 2:return t.next=4,e.queryByNameOrTypeId();case 4:return t.next=6,e.getTitleImage();case 6:case"end":return t.stop()}},t,e)}))()},methods:{submitQuery:function(){console.log("submit!"),this.queryByNameOrTypeId(this.formInfo.name,this.formInfo.type)},resetForm:function(){this.$refs.form.resetFields()},handleCurrentChange:function(e){console.log("当前页: "+e)},handleCamera:function(e){this.$router.push({name:"set_camera",params:{deviceId:e.deviceId,deviceName:e.deviceName}})},handleImage:function(e){this.deviceInfo=e,this.imageVisible=!0},handleEdit:function(e){this.addOrEdit="edit",this.deviceInfo=e,this.deviceVisible=!0},addDevice:function(){this.addOrEdit="add",this.deviceVisible=!0},queryByNameOrTypeId:function(e,t){var a=this;return s()(i.a.mark(function r(){var n;return i.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,a.$http.post("/device/queryByNameOrTypeId",{deviceName:e,deviceTypeId:t});case 3:n=r.sent,a.tableData=n.data.data,a.changeTableData(),r.next=11;break;case 8:r.prev=8,r.t0=r.catch(0),console.log(r.t0);case 11:case"end":return r.stop()}},r,a,[[0,8]])}))()},deleteDevice:function(e){var t=this;return s()(i.a.mark(function a(){var r;return i.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,t.$http.post("/device/delete",{deviceId:e.deviceId});case 3:200==(r=a.sent).data.code?(t.$message.success("删除设备成功"),t.queryByNameOrTypeId()):t.$message.error(r.data.msg),a.next=10;break;case 7:a.prev=7,a.t0=a.catch(0),console.log(a.t0);case 10:case"end":return a.stop()}},a,t,[[0,7]])}))()},getDeviceTypeAll:function(){var e=this;return s()(i.a.mark(function t(){var a;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.$http.get("/deviceType/queryAll");case 3:a=t.sent,e.typeList=a.data.data,t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),console.log(t.t0);case 10:case"end":return t.stop()}},t,e,[[0,7]])}))()},changeTableData:function(){var e=this;this.tableData.map(function(t){e.typeList.forEach(function(e){t.deviceTypeId===e.deviceTypeId&&(t.deviceTypeName=e.deviceTypeName,t.communicationProtocol=e.communicationProtocol.name)})})},getTitleImage:function(){var e=this;return s()(i.a.mark(function t(){var a;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.$http.get("/system/query");case 3:a=t.sent,e.imageUrl=a.data.data.mapPath,t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),console.log(t.t0);case 10:case"end":return t.stop()}},t,e,[[0,7]])}))()}}},v={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"box-card"},[a("el-form",{ref:"form",staticClass:"form-inline",attrs:{inline:!0,model:e.formInfo}},[a("el-form-item",{attrs:{label:"设备名称",prop:"name"}},[a("el-input",{attrs:{placeholder:"请输入设备名称"},model:{value:e.formInfo.name,callback:function(t){e.$set(e.formInfo,"name",t)},expression:"formInfo.name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"设备类型",prop:"type"}},[a("el-select",{attrs:{clearable:"",placeholder:"请选择设备类型"},model:{value:e.formInfo.type,callback:function(t){e.$set(e.formInfo,"type",t)},expression:"formInfo.type"}},e._l(e.typeList,function(e,t){return a("el-option",{key:t,attrs:{label:e.deviceTypeName+"（"+e.communicationProtocol.name+"）",value:e.deviceTypeId}})}),1)],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary",size:"medium"},on:{click:e.submitQuery}},[e._v("查询")]),e._v(" "),a("el-button",{attrs:{size:"medium"},on:{click:e.resetForm}},[e._v("重置")])],1)],1)],1),e._v(" "),a("div",{staticClass:"box-table"},[a("el-button",{staticClass:"space-button",attrs:{type:"primary",size:"medium",icon:"el-icon-plus"},on:{click:e.addDevice}},[e._v("新建")]),e._v(" "),a("el-table",{attrs:{data:e.tableData,border:!0,stripe:!0}},[a("el-table-column",{attrs:{type:"index",width:"80",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{label:"设备类型",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.deviceTypeName)+" "),a("br"),e._v(" "+e._s("（"+t.row.communicationProtocol+"）"))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"deviceName",label:"设备名称",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{prop:"ip",label:"IP地址",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{prop:"port",label:"端口号",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{label:"摄像头",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"primary",plain:"",size:"small"},on:{click:function(a){return e.handleCamera(t.row)}}},[e._v("设置")])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"deviceLocation",label:"设备位置",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"primary",plain:"",size:"small"},on:{click:function(a){return e.handleImage(t.row)}}},[e._v("设置")])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"enableStatus",label:"设备状态",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-switch",{attrs:{disabled:"","active-color":"#13ce66","inactive-color":"#ff4949","active-value":1,"inactive-value":0},model:{value:t.row.enableStatus.value,callback:function(a){e.$set(t.row.enableStatus,"value",a)},expression:"scope.row.enableStatus.value"}}),e._v(" "),a("span",[e._v(e._s(t.row.enableStatus.name))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"sortNumber",label:"排序序号",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{label:"操作",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){return e.handleEdit(t.row)}}},[e._v("编辑")]),e._v(" "),a("el-popconfirm",{attrs:{title:"确定删除吗？"},on:{confirm:function(a){return e.deleteDevice(t.row)}}},[a("el-button",{attrs:{slot:"reference",type:"text",size:"small"},slot:"reference"},[e._v("删除")])],1)]}}])})],1)],1),e._v(" "),a("device-modal",{attrs:{visible:e.deviceVisible,addOrEdit:e.addOrEdit,deviceInfo:e.deviceInfo},on:{"update:visible":function(t){e.deviceVisible=t}}}),e._v(" "),a("image-modal",{attrs:{visible:e.imageVisible,deviceInfo:e.deviceInfo,imageUrl:e.imageUrl},on:{"update:visible":function(t){e.imageVisible=t}}})],1)},staticRenderFns:[]};var h=a("VU/8")(f,v,!1,function(e){a("/WlP")},"data-v-081c22e4",null);t.default=h.exports}});